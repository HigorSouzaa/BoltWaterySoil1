<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Simuladores Eco-Soil Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .content {
            padding: 30px;
        }

        .config-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .config-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .toggle-container:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .toggle-info {
            flex: 1;
        }

        .toggle-info h3 {
            color: #333;
            margin-bottom: 5px;
            font-size: 1.2rem;
        }

        .toggle-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        /* Simulators Grid */
        .simulators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .simulator-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #e0e0e0;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .simulator-card.active {
            border-color: #667eea;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .simulator-card.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .simulator-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .simulator-card.ideal h3 {
            color: #4caf50;
        }

        .simulator-card.good h3 {
            color: #ff9800;
        }

        .simulator-card.bad h3 {
            color: #f44336;
        }

        .simulator-params {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        .simulator-params p {
            margin: 5px 0;
            color: #666;
        }

        /* Checkbox Animado */
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .custom-checkbox {
            position: relative;
            width: 24px;
            height: 24px;
        }

        .custom-checkbox input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 0;
            height: 24px;
            width: 24px;
            background-color: #eee;
            border-radius: 6px;
            border: 2px solid #ddd;
            transition: all 0.3s;
            cursor: pointer;
        }

        .custom-checkbox:hover .checkmark {
            background-color: #e0e0e0;
        }

        .custom-checkbox input:checked ~ .checkmark {
            background-color: #667eea;
            border-color: #667eea;
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            left: 7px;
            top: 3px;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .custom-checkbox input:checked ~ .checkmark:after {
            display: block;
            animation: checkAnim 0.3s ease;
        }

        @keyframes checkAnim {
            0% {
                height: 0;
            }
            100% {
                height: 12px;
            }
        }

        .checkbox-label {
            font-weight: 600;
            color: #333;
            cursor: pointer;
            user-select: none;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 10px;
        }

        .status-running {
            background: #e8f5e9;
            color: #2e7d32;
            animation: blink 2s ease-in-out infinite;
        }

        .status-stopped {
            background: #ffebee;
            color: #c62828;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Logs Section */
        .logs-section {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .logs-section h3 {
            color: #fff;
            margin-bottom: 15px;
            font-family: 'Segoe UI', sans-serif;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #858585;
            margin-right: 10px;
        }

        .log-success {
            color: #4caf50;
        }

        .log-error {
            color: #f44336;
        }

        .log-info {
            color: #2196f3;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-clear {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #90caf9;
        }

        @media (max-width: 768px) {
            .simulators-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Controle de Simuladores</h1>
            <p>Eco-Soil Pro - Simula√ß√£o de Hardware em Tempo Real</p>
        </div>

        <div class="content">
            <!-- Configura√ß√µes -->
            <div class="config-section">
                <h2>‚öôÔ∏è Configura√ß√µes Globais</h2>
                
                <div class="alert alert-info">
                    ‚ÑπÔ∏è Configure o MAC Address e o intervalo de envio. Certifique-se de que o dispositivo est√° registrado e vinculado a um m√≥dulo.
                </div>

                <div class="form-group">
                    <label for="mac_address">MAC Address do Dispositivo</label>
                    <input 
                        type="text" 
                        id="mac_address" 
                        placeholder="AA:AA:AA:AA:AA:AA"
                        value="AA:AA:AA:AA:AA:AA"
                        maxlength="17"
                    >
                </div>

                <div class="form-group">
                    <label for="interval">Intervalo de Envio (ms)</label>
                    <input 
                        type="number" 
                        id="interval" 
                        placeholder="2000"
                        value="2000"
                        min="1000"
                        step="500"
                    >
                </div>

                <div class="form-group">
                    <label for="api_url">URL da API</label>
                    <input 
                        type="text" 
                        id="api_url" 
                        placeholder="http://localhost:3000/api/v1"
                        value="http://localhost:3000/api/v1"
                    >
                </div>
            </div>

            <!-- Master Toggle -->
            <div class="config-section">
                <h2>üîå Controle Principal</h2>
                <div class="toggle-container">
                    <div class="toggle-info">
                        <h3>Sistema de Simula√ß√£o</h3>
                        <p>Ativar/Desativar todos os simuladores</p>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="master-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <!-- Simuladores -->
            <div class="config-section">
                <h2>üéØ Simuladores Dispon√≠veis</h2>
                
                <div class="simulators-grid">
                    <!-- Simulador IDEAL -->
                    <div class="simulator-card ideal" id="card-ideal">
                        <h3>
                            üå± Valores IDEAIS
                        </h3>
                        <div class="simulator-params">
                            <p><strong>Umidade:</strong> 20-30%</p>
                            <p><strong>Temperatura:</strong> 20-30¬∞C</p>
                            <p><strong>F√≥sforo:</strong> 20-40 ppm</p>
                            <p><strong>Pot√°ssio:</strong> 100-150 ppm</p>
                            <p><strong>pH:</strong> 6.0-7.0</p>
                        </div>
                        
                        <div class="checkbox-container">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="sim-ideal" class="simulator-checkbox">
                                <span class="checkmark"></span>
                            </label>
                            <label for="sim-ideal" class="checkbox-label">Ativar Simulador Ideal</label>
                        </div>
                        
                        <span class="status-badge status-stopped" id="status-ideal">‚ö´ Parado</span>
                    </div>

                    <!-- Simulador GOOD -->
                    <div class="simulator-card good" id="card-good">
                        <h3>
                            üü° Valores BONS
                        </h3>
                        <div class="simulator-params">
                            <p><strong>Umidade:</strong> 18-20% ou 30-35%</p>
                            <p><strong>Temperatura:</strong> 15-20¬∞C ou 30-32¬∞C</p>
                            <p><strong>F√≥sforo:</strong> 15-20 ou 40-50 ppm</p>
                            <p><strong>Pot√°ssio:</strong> 80-100 ou 150-180 ppm</p>
                            <p><strong>pH:</strong> 5.5-6.0 ou 7.0-7.5</p>
                        </div>
                        
                        <div class="checkbox-container">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="sim-good" class="simulator-checkbox">
                                <span class="checkmark"></span>
                            </label>
                            <label for="sim-good" class="checkbox-label">Ativar Simulador Bom</label>
                        </div>
                        
                        <span class="status-badge status-stopped" id="status-good">‚ö´ Parado</span>
                    </div>

                    <!-- Simulador BAD -->
                    <div class="simulator-card bad" id="card-bad">
                        <h3>
                            üî¥ Valores RUINS
                        </h3>
                        <div class="simulator-params">
                            <p><strong>Umidade:</strong> &lt;18% ou &gt;35%</p>
                            <p><strong>Temperatura:</strong> &lt;15¬∞C ou &gt;32¬∞C</p>
                            <p><strong>F√≥sforo:</strong> &lt;15 ou &gt;50 ppm</p>
                            <p><strong>Pot√°ssio:</strong> &lt;80 ou &gt;180 ppm</p>
                            <p><strong>pH:</strong> &lt;5.5 ou &gt;7.5</p>
                        </div>
                        
                        <div class="checkbox-container">
                            <label class="custom-checkbox">
                                <input type="checkbox" id="sim-bad" class="simulator-checkbox">
                                <span class="checkmark"></span>
                            </label>
                            <label for="sim-bad" class="checkbox-label">Ativar Simulador Ruim</label>
                        </div>
                        
                        <span class="status-badge status-stopped" id="status-bad">‚ö´ Parado</span>
                    </div>
                </div>
            </div>

            <!-- Logs -->
            <div class="logs-section">
                <h3>üìã Logs do Sistema</h3>
                <div id="logs-container">
                    <div class="log-entry log-info">
                        <span class="log-time">[00:00:00]</span>
                        Sistema iniciado. Aguardando ativa√ß√£o dos simuladores...
                    </div>
                </div>
                <button class="btn btn-clear" onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>
            </div>
        </div>
    </div>

    <script>
        // Estado global
        const state = {
            masterEnabled: false,
            simulators: {
                ideal: { enabled: false, interval: null, device: null, module: null },
                good: { enabled: false, interval: null, device: null, module: null },
                bad: { enabled: false, interval: null, device: null, module: null }
            },
            config: {
                macAddress: 'AA:BB:CC:DD:EE:FF',
                interval: 2000,
                apiUrl: 'https://backend-waterysoil.onrender.com/api/v1'
            }
        };

        // Utilidades
        function clamp(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        function addLog(message, type = 'info') {
            const logsContainer = document.getElementById('logs-container');
            const now = new Date();
            const time = now.toLocaleTimeString('pt-BR');
            
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<span class="log-time">[${time}]</span>${message}`;
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        function clearLogs() {
            const logsContainer = document.getElementById('logs-container');
            logsContainer.innerHTML = '<div class="log-entry log-info"><span class="log-time">[' + 
                new Date().toLocaleTimeString('pt-BR') + ']</span>Logs limpos.</div>';
        }

        function updateConfig() {
            state.config.macAddress = document.getElementById('mac_address').value;
            state.config.interval = parseInt(document.getElementById('interval').value);
            state.config.apiUrl = document.getElementById('api_url').value;
        }

        // Fun√ß√µes de simula√ß√£o
        function generateIdealData(last) {
            return {
                soil_moisture: clamp(last.soil_moisture + (Math.random() - 0.5) * 2, 20, 30),
                temperature: clamp(last.temperature + (Math.random() - 0.5) * 1, 20, 30),
                nitrogen: clamp(last.nitrogen + (Math.random() - 0.5) * 2, 40, 60),
                phosphorus: clamp(last.phosphorus + (Math.random() - 0.5) * 2, 20, 40),
                potassium: clamp(last.potassium + (Math.random() - 0.5) * 5, 100, 150),
                ph: clamp(last.ph + (Math.random() - 0.5) * 0.1, 6.0, 7.0)
            };
        }

        function generateGoodData(last) {
            const useLowRange = Math.random() > 0.5;
            return {
                soil_moisture: useLowRange 
                    ? clamp(last.soil_moisture + (Math.random() - 0.5) * 1, 18, 20)
                    : clamp(last.soil_moisture + (Math.random() - 0.5) * 2, 30, 35),
                temperature: useLowRange
                    ? clamp(last.temperature + (Math.random() - 0.5) * 1, 15, 20)
                    : clamp(last.temperature + (Math.random() - 0.5) * 0.5, 30, 32),
                nitrogen: clamp(last.nitrogen + (Math.random() - 0.5) * 2, 40, 60),
                phosphorus: useLowRange
                    ? clamp(last.phosphorus + (Math.random() - 0.5) * 1, 15, 20)
                    : clamp(last.phosphorus + (Math.random() - 0.5) * 2, 40, 50),
                potassium: useLowRange
                    ? clamp(last.potassium + (Math.random() - 0.5) * 3, 80, 100)
                    : clamp(last.potassium + (Math.random() - 0.5) * 5, 150, 180),
                ph: useLowRange
                    ? clamp(last.ph + (Math.random() - 0.5) * 0.1, 5.5, 6.0)
                    : clamp(last.ph + (Math.random() - 0.5) * 0.1, 7.0, 7.5)
            };
        }

        function generateBadData(last) {
            const useLowRange = Math.random() > 0.5;
            return {
                soil_moisture: useLowRange 
                    ? clamp(last.soil_moisture + (Math.random() - 0.5) * 2, 5, 17)
                    : clamp(last.soil_moisture + (Math.random() - 0.5) * 3, 36, 50),
                temperature: useLowRange
                    ? clamp(last.temperature + (Math.random() - 0.5) * 1, 10, 14)
                    : clamp(last.temperature + (Math.random() - 0.5) * 1, 33, 38),
                nitrogen: clamp(last.nitrogen + (Math.random() - 0.5) * 2, 40, 60),
                phosphorus: useLowRange
                    ? clamp(last.phosphorus + (Math.random() - 0.5) * 1, 5, 14)
                    : clamp(last.phosphorus + (Math.random() - 0.5) * 2, 51, 70),
                potassium: useLowRange
                    ? clamp(last.potassium + (Math.random() - 0.5) * 3, 40, 79)
                    : clamp(last.potassium + (Math.random() - 0.5) * 5, 181, 220),
                ph: useLowRange
                    ? clamp(last.ph + (Math.random() - 0.5) * 0.2, 4.0, 5.4)
                    : clamp(last.ph + (Math.random() - 0.5) * 0.2, 7.6, 8.5)
            };
        }

        const dataGenerators = {
            ideal: generateIdealData,
            good: generateGoodData,
            bad: generateBadData
        };

        const initialData = {
            ideal: { soil_moisture: 25, temperature: 25, nitrogen: 50, phosphorus: 30, potassium: 125, ph: 6.5 },
            good: { soil_moisture: 19, temperature: 18, nitrogen: 50, phosphorus: 18, potassium: 90, ph: 5.7 },
            bad: { soil_moisture: 10, temperature: 35, nitrogen: 50, phosphorus: 10, potassium: 60, ph: 4.5 }
        };

        // API Functions
        async function identifyDevice(type) {
            try {
                updateConfig();
                const response = await fetch(
                    `${state.config.apiUrl}/ecosoil-devices/mac/${state.config.macAddress}`
                );
                const data = await response.json();

                if (data.success) {
                    state.simulators[type].device = data.data;
                    addLog(`‚úÖ [${type.toUpperCase()}] Dispositivo encontrado: ${data.data.serial_number}`, 'success');
                    return true;
                }
            } catch (error) {
                addLog(`‚ùå [${type.toUpperCase()}] Erro ao identificar dispositivo: ${error.message}`, 'error');
                return false;
            }
        }

        async function findLinkedModule(type) {
            try {
                updateConfig();
                const response = await fetch(
                    `${state.config.apiUrl}/waterysoil-modules/by-mac/${state.config.macAddress}`
                );
                const data = await response.json();

                if (data.success) {
                    state.simulators[type].module = data.data;
                    addLog(`‚úÖ [${type.toUpperCase()}] M√≥dulo encontrado: ${data.data.name}`, 'success');
                    return true;
                }
            } catch (error) {
                addLog(`‚ùå [${type.toUpperCase()}] Erro ao buscar m√≥dulo: ${error.message}`, 'error');
                return false;
            }
        }

        async function sendSensorData(type) {
            const sim = state.simulators[type];
            if (!sim.module || !sim.lastData) return;

            try {
                const newData = dataGenerators[type](sim.lastData);
                sim.lastData = newData;

                const payload = {
                    sensor_data: {
                        soil_moisture: {
                            value: parseFloat(newData.soil_moisture.toFixed(1)),
                            last_update: new Date()
                        },
                        temperature: {
                            value: parseFloat(newData.temperature.toFixed(1)),
                            last_update: new Date()
                        },
                        npk: {
                            nitrogen: parseFloat(newData.nitrogen.toFixed(1)),
                            phosphorus: parseFloat(newData.phosphorus.toFixed(1)),
                            potassium: parseFloat(newData.potassium.toFixed(1)),
                            last_update: new Date()
                        },
                        ph: {
                            value: parseFloat(newData.ph.toFixed(2)),
                            last_update: new Date()
                        }
                    }
                };

                const response = await fetch(
                    `${state.config.apiUrl}/waterysoil-modules/${sim.module._id}/sensor-data`,
                    {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }
                );

                const data = await response.json();

                if (data.success) {
                    const icon = type === 'ideal' ? 'üå±' : type === 'good' ? 'üü°' : 'üî¥';
                    addLog(
                        `${icon} [${type.toUpperCase()}] Dados enviados: ` +
                        `Umidade: ${newData.soil_moisture.toFixed(1)}%, ` +
                        `Temp: ${newData.temperature.toFixed(1)}¬∞C, ` +
                        `pH: ${newData.ph.toFixed(2)}`,
                        'success'
                    );
                }
            } catch (error) {
                addLog(`‚ùå [${type.toUpperCase()}] Erro ao enviar dados: ${error.message}`, 'error');
            }
        }

        // Control Functions
        async function startSimulator(type) {
            if (state.simulators[type].enabled) return;

            addLog(`üöÄ [${type.toUpperCase()}] Iniciando simulador...`, 'info');

            const deviceFound = await identifyDevice(type);
            if (!deviceFound) {
                document.getElementById(`sim-${type}`).checked = false;
                return;
            }

            const moduleFound = await findLinkedModule(type);
            if (!moduleFound) {
                document.getElementById(`sim-${type}`).checked = false;
                return;
            }

            state.simulators[type].enabled = true;
            state.simulators[type].lastData = { ...initialData[type] };

            // Enviar dados imediatamente
            await sendSensorData(type);

            // Configurar intervalo
            updateConfig();
            state.simulators[type].interval = setInterval(() => {
                sendSensorData(type);
            }, state.config.interval);

            // Atualizar UI
            document.getElementById(`card-${type}`).classList.add('active');
            document.getElementById(`status-${type}`).textContent = 'üü¢ Rodando';
            document.getElementById(`status-${type}`).className = 'status-badge status-running';

            addLog(`‚úÖ [${type.toUpperCase()}] Simulador ativado com sucesso!`, 'success');
        }

        function stopSimulator(type) {
            if (!state.simulators[type].enabled) return;

            if (state.simulators[type].interval) {
                clearInterval(state.simulators[type].interval);
                state.simulators[type].interval = null;
            }

            state.simulators[type].enabled = false;
            state.simulators[type].device = null;
            state.simulators[type].module = null;
            state.simulators[type].lastData = null;

            // Atualizar UI
            document.getElementById(`card-${type}`).classList.remove('active');
            document.getElementById(`status-${type}`).textContent = '‚ö´ Parado';
            document.getElementById(`status-${type}`).className = 'status-badge status-stopped';

            addLog(`‚è∏Ô∏è [${type.toUpperCase()}] Simulador parado.`, 'info');
        }

        // Event Listeners
        document.getElementById('master-toggle').addEventListener('change', function(e) {
            state.masterEnabled = e.target.checked;

            if (!state.masterEnabled) {
                // Desativar todos
                ['ideal', 'good', 'bad'].forEach(type => {
                    document.getElementById(`sim-${type}`).checked = false;
                    stopSimulator(type);
                });
                addLog('‚è∏Ô∏è Sistema de simula√ß√£o desativado.', 'info');
            } else {
                addLog('‚úÖ Sistema de simula√ß√£o ativado. Selecione os simuladores.', 'success');
            }
        });

        ['ideal', 'good', 'bad'].forEach(type => {
            document.getElementById(`sim-${type}`).addEventListener('change', function(e) {
                if (!state.masterEnabled) {
                    e.target.checked = false;
                    addLog('‚ö†Ô∏è Ative o sistema principal primeiro!', 'error');
                    return;
                }

                if (e.target.checked) {
                    startSimulator(type);
                } else {
                    stopSimulator(type);
                }
            });
        });

        // Formatar MAC Address
        document.getElementById('mac_address').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9A-Fa-f]/g, '');
            let formatted = '';
            
            for (let i = 0; i < value.length && i < 12; i++) {
                if (i > 0 && i % 2 === 0) {
                    formatted += ':';
                }
                formatted += value[i];
            }
            
            e.target.value = formatted.toUpperCase();
        });

        // Log inicial
        addLog('üéÆ Sistema de controle de simuladores carregado.', 'success');
    </script>
</body>
</html>
